---
/**
 * 通用加载状态组件
 * 支持多种加载动画样式和尺寸
 */

interface Props {
  variant?: 'spinner' | 'dots' | 'pulse' | 'bars' | 'ring';
  size?: 'sm' | 'md' | 'lg' | 'xl';
  color?: 'primary' | 'secondary' | 'white' | 'gray';
  text?: string;
  fullScreen?: boolean;
  overlay?: boolean;
  class?: string;
}

const {
  variant = 'spinner',
  size = 'md',
  color = 'primary',
  text,
  fullScreen = false,
  overlay = false,
  class: className = '',
} = Astro.props;

// 尺寸映射
const sizeMap = {
  sm: { spinner: 'w-4 h-4', text: 'text-sm' },
  md: { spinner: 'w-8 h-8', text: 'text-base' },
  lg: { spinner: 'w-12 h-12', text: 'text-lg' },
  xl: { spinner: 'w-16 h-16', text: 'text-xl' },
};

// 颜色映射
const colorMap = {
  primary: 'text-blue-600',
  secondary: 'text-gray-600',
  white: 'text-white',
  gray: 'text-gray-400',
};

// 容器样式
const containerClasses = [
  fullScreen 
    ? 'fixed inset-0 z-50 flex items-center justify-center' 
    : 'flex items-center justify-center',
  overlay ? 'bg-white/80 backdrop-blur-sm' : '',
  className,
].filter(Boolean).join(' ');

// 加载器样式
const loaderClasses = [
  sizeMap[size].spinner,
  colorMap[color],
].join(' ');
---

<div class={containerClasses} role="status" aria-live="polite" aria-label="Loading">
  <div class="flex flex-col items-center gap-3">
    <!-- Spinner -->
    {variant === 'spinner' && (
      <svg class={`animate-spin ${loaderClasses}`} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
    )}
    
    <!-- Dots -->
    {variant === 'dots' && (
      <div class="flex gap-2">
        <div class={`${loaderClasses} rounded-full bg-current animate-bounce`} style="animation-delay: 0ms"></div>
        <div class={`${loaderClasses} rounded-full bg-current animate-bounce`} style="animation-delay: 150ms"></div>
        <div class={`${loaderClasses} rounded-full bg-current animate-bounce`} style="animation-delay: 300ms"></div>
      </div>
    )}
    
    <!-- Pulse -->
    {variant === 'pulse' && (
      <div class={`${loaderClasses} rounded-full bg-current animate-pulse`}></div>
    )}
    
    <!-- Bars -->
    {variant === 'bars' && (
      <div class="flex gap-1 items-end" style={`height: ${sizeMap[size].spinner.split(' ')[0].replace('w-', '')}rem`}>
        <div class={`w-1 bg-current animate-pulse`} style="animation-delay: 0ms; height: 100%"></div>
        <div class={`w-1 bg-current animate-pulse`} style="animation-delay: 150ms; height: 75%"></div>
        <div class={`w-1 bg-current animate-pulse`} style="animation-delay: 300ms; height: 50%"></div>
        <div class={`w-1 bg-current animate-pulse`} style="animation-delay: 450ms; height: 75%"></div>
        <div class={`w-1 bg-current animate-pulse`} style="animation-delay: 600ms; height: 100%"></div>
      </div>
    )}
    
    <!-- Ring -->
    {variant === 'ring' && (
      <div class={`${loaderClasses} border-4 border-current border-t-transparent rounded-full animate-spin`}></div>
    )}
    
    <!-- Loading Text -->
    {text && (
      <p class={`${sizeMap[size].text} ${colorMap[color]} font-medium`}>
        {text}
      </p>
    )}
  </div>
</div>

<style>
  /* 自定义动画 */
  @keyframes bounce {
    0%, 100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-50%);
    }
  }
  
  .animate-bounce {
    animation: bounce 0.6s infinite;
  }
  
  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }
  
  .animate-spin {
    animation: spin 1s linear infinite;
  }
  
  @keyframes pulse {
    0%, 100% {
      opacity: 1;
    }
    50% {
      opacity: 0.5;
    }
  }
  
  .animate-pulse {
    animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }
  
  /* 确保全屏加载器在最顶层 */
  .fixed.z-50 {
    pointer-events: auto;
  }
</style>
