---
// FAQ列表组件 - 手风琴式展开/收起
// 基于Raytron金属扁线业务的真实问题

interface FAQ {
  question: string;
  answer: string;
  category: string;
}

interface Props {
  faqs: FAQ[];
  category?: string; // 可选的分类过滤
  showCategories?: boolean; // 是否显示分类标签
}

const { faqs, category, showCategories = true } = Astro.props;

// 如果指定了分类，则过滤FAQ
const filteredFAQs = category 
  ? faqs.filter(faq => faq.category === category)
  : faqs;

// 获取所有唯一的分类
const categories = [...new Set(faqs.map(faq => faq.category))];

// 分类颜色映射
const categoryColors: Record<string, string> = {
  'products': 'blue',
  'technical': 'purple',
  'ordering': 'green',
  'quality': 'orange',
  'delivery': 'red',
  'customization': 'indigo',
  'support': 'pink'
};
---

<div class="faq-list">
  <!-- 分类标签（如果启用） -->
  {showCategories && categories.length > 1 && (
    <div class="categories-filter">
      <button 
        class={`category-btn ${!category ? 'active' : ''}`}
        data-category="all"
      >
        全部问题 ({faqs.length})
      </button>
      {categories.map((cat) => (
        <button 
          class={`category-btn ${category === cat ? 'active' : ''}`}
          data-category={cat}
        >
          {cat === 'products' && '产品相关'}
          {cat === 'technical' && '技术规格'}
          {cat === 'ordering' && '订购流程'}
          {cat === 'quality' && '质量保证'}
          {cat === 'delivery' && '交付物流'}
          {cat === 'customization' && '定制服务'}
          {cat === 'support' && '技术支持'}
          ({faqs.filter(f => f.category === cat).length})
        </button>
      ))}
    </div>
  )}

  <!-- FAQ列表 -->
  <div class="faq-items">
    {filteredFAQs.map((faq, index) => (
      <div class="faq-item" data-category={faq.category}>
        <button class="faq-question" aria-expanded="false">
          <span class="question-text">{faq.question}</span>
          <span class="category-badge" data-color={categoryColors[faq.category] || 'gray'}>
            {faq.category === 'products' && '产品'}
            {faq.category === 'technical' && '技术'}
            {faq.category === 'ordering' && '订购'}
            {faq.category === 'quality' && '质量'}
            {faq.category === 'delivery' && '交付'}
            {faq.category === 'customization' && '定制'}
            {faq.category === 'support' && '支持'}
          </span>
          <svg class="chevron" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>
        <div class="faq-answer">
          <div class="answer-content" set:html={faq.answer} />
        </div>
      </div>
    ))}
  </div>

  <!-- 没有找到FAQ时的提示 -->
  {filteredFAQs.length === 0 && (
    <div class="no-results">
      <svg class="icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <p>该分类下暂无常见问题</p>
    </div>
  )}
</div>

<style>
  .faq-list {
    width: 100%;
  }

  /* 分类过滤器 */
  .categories-filter {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid #e5e7eb;
  }

  .category-btn {
    padding: 0.5rem 1rem;
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 9999px;
    font-size: 0.875rem;
    font-weight: 500;
    color: #6b7280;
    cursor: pointer;
    transition: all 0.2s;
  }

  .category-btn:hover {
    background: #f9fafb;
    border-color: #d1d5db;
    color: #374151;
  }

  .category-btn.active {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    border-color: #3b82f6;
    color: white;
    box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
  }

  /* FAQ项目 */
  .faq-items {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .faq-item {
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    overflow: hidden;
    transition: all 0.3s;
  }

  .faq-item:hover {
    border-color: #3b82f6;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  }

  .faq-item.open {
    border-color: #3b82f6;
    box-shadow: 0 4px 16px rgba(59, 130, 246, 0.15);
  }

  /* 问题按钮 */
  .faq-question {
    width: 100%;
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.25rem 1.5rem;
    background: transparent;
    border: none;
    text-align: left;
    cursor: pointer;
    transition: background 0.2s;
  }

  .faq-question:hover {
    background: #f9fafb;
  }

  .question-text {
    flex: 1;
    font-size: 1rem;
    font-weight: 600;
    color: #111827;
    line-height: 1.5;
  }

  .category-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.025em;
  }

  .category-badge[data-color="blue"] {
    background: #dbeafe;
    color: #1e40af;
  }

  .category-badge[data-color="purple"] {
    background: #ede9fe;
    color: #6b21a8;
  }

  .category-badge[data-color="green"] {
    background: #dcfce7;
    color: #166534;
  }

  .category-badge[data-color="orange"] {
    background: #fed7aa;
    color: #c2410c;
  }

  .category-badge[data-color="red"] {
    background: #fecaca;
    color: #991b1b;
  }

  .category-badge[data-color="indigo"] {
    background: #e0e7ff;
    color: #4338ca;
  }

  .category-badge[data-color="pink"] {
    background: #fce7f3;
    color: #be185d;
  }

  .chevron {
    width: 1.25rem;
    height: 1.25rem;
    color: #9ca3af;
    transition: transform 0.3s, color 0.2s;
    flex-shrink: 0;
  }

  .faq-item.open .chevron {
    transform: rotate(180deg);
    color: #3b82f6;
  }

  /* 答案区域 */
  .faq-answer {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
  }

  .faq-item.open .faq-answer {
    max-height: 2000px;
  }

  .answer-content {
    padding: 0 1.5rem 1.5rem;
    color: #4b5563;
    line-height: 1.75;
  }

  .answer-content :global(p) {
    margin-bottom: 0.75rem;
  }

  .answer-content :global(p:last-child) {
    margin-bottom: 0;
  }

  .answer-content :global(ul) {
    list-style: disc;
    margin-left: 1.5rem;
    margin-bottom: 0.75rem;
  }

  .answer-content :global(li) {
    margin-bottom: 0.5rem;
  }

  .answer-content :global(strong) {
    font-weight: 600;
    color: #111827;
  }

  .answer-content :global(a) {
    color: #3b82f6;
    text-decoration: underline;
  }

  .answer-content :global(a:hover) {
    color: #2563eb;
  }

  /* 无结果提示 */
  .no-results {
    text-align: center;
    padding: 4rem 2rem;
  }

  .no-results .icon {
    width: 4rem;
    height: 4rem;
    margin: 0 auto 1rem;
    color: #d1d5db;
  }

  .no-results p {
    color: #6b7280;
    font-size: 1rem;
  }

  /* 响应式 */
  @media (max-width: 768px) {
    .categories-filter {
      margin-bottom: 1.5rem;
    }

    .category-btn {
      font-size: 0.8125rem;
      padding: 0.4rem 0.875rem;
    }

    .faq-question {
      padding: 1rem;
      gap: 0.75rem;
    }

    .question-text {
      font-size: 0.9375rem;
    }

    .category-badge {
      display: none; /* 移动端隐藏分类徽章 */
    }

    .answer-content {
      padding: 0 1rem 1rem;
      font-size: 0.9375rem;
    }
  }
</style>

<script>
  // FAQ手风琴功能
  document.addEventListener('DOMContentLoaded', () => {
    const faqItems = document.querySelectorAll('.faq-item');
    
    faqItems.forEach(item => {
      const question = item.querySelector('.faq-question');
      
      question?.addEventListener('click', () => {
        const isOpen = item.classList.contains('open');
        
        // 关闭所有其他FAQ（可选：如果想要同时打开多个，删除这段代码）
        faqItems.forEach(otherItem => {
          if (otherItem !== item) {
            otherItem.classList.remove('open');
            otherItem.querySelector('.faq-question')?.setAttribute('aria-expanded', 'false');
          }
        });
        
        // 切换当前FAQ
        item.classList.toggle('open');
        question.setAttribute('aria-expanded', String(!isOpen));
      });
    });

    // 分类过滤功能
    const categoryBtns = document.querySelectorAll('.category-btn');
    
    categoryBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const category = btn.getAttribute('data-category');
        
        // 更新活动状态
        categoryBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        // 过滤FAQ项目
        if (category === 'all') {
          faqItems.forEach(item => {
            item.style.display = 'block';
          });
        } else {
          faqItems.forEach(item => {
            const itemCategory = item.getAttribute('data-category');
            item.style.display = itemCategory === category ? 'block' : 'none';
          });
        }
        
        // 关闭所有打开的FAQ
        faqItems.forEach(item => {
          item.classList.remove('open');
          item.querySelector('.faq-question')?.setAttribute('aria-expanded', 'false');
        });
      });
    });
  });
</script>
